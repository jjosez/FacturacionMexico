<div class="modal fade" id="product:link:modal" tabindex="-1" aria-labelledby="product:link:modal:label"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="product:link:modal:label">
                    Vincular producto <span class="text-muted" id="product:link:modal:code"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="buscarProductoInput" class="form-control mb-2"
                       placeholder="Buscar producto por SKU o descripción">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover" id="tablaProductos">
                        <thead>
                        <tr>
                            <th>Referencia</th>
                            <th>Ref. Fabricante</th>
                            <th>Fabricante</th>
                            <th>Descripción</th>
                            <th>Acción</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{# Templates Eta para renderizado dinámico #}
<script type="text/template" id="product:search:row:template">
    <td><%= it.referencia %></td>
    <td><%= it.referencia_fabricante || it.refproveedor || '—' %></td>
    <td><%= it.codfabricante || '—' %></td>
    <td><%= it.descripcion %></td>
    <td>
        <button type="button"
                class="btn btn-sm btn-success"
                data-action="product:select"
                data-referencia="<%= it.referencia %>">
            Seleccionar
        </button>
    </td>
</script>

<script type="text/template" id="product:search:empty:template">
    <td colspan="5" class="text-center text-muted">
        <%= it.message || 'No se encontraron productos' %>
    </td>
</script>

<script type="text/template" id="product:search:loading:template">
    <td colspan="5" class="text-center">
        <div class="spinner-border spinner-border-sm text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
        <span class="ms-2"><%= it.message || 'Buscando productos...' %></span>
    </td>
</script>

<script type="text/template" id="product:search:error:template">
    <td colspan="5" class="text-center text-danger">
        <i class="fas fa-exclamation-triangle"></i>
        <span class="ms-2"><%= it.message || 'Error al buscar productos' %></span>
    </td>
</script>

<script type="text/template" id="product:toast:template">
    <div class="toast-header <%= it.bgClass %> text-white">
        <strong class="me-auto"><%= it.title || 'Notificación' %></strong>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body">
        <%= it.message %>
    </div>
</script>
